{{/* Anemone v2 - User quota management */}}
{{define "content"}}
<!-- Back link -->
<div style="margin-bottom:1.5rem;">
    <a href="/admin/users" style="font-size:0.8125rem;color:var(--info);text-decoration:none;display:inline-flex;align-items:center;gap:0.25rem;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 19l-7-7 7-7"/></svg>
        {{T .Lang "common.back"}}
    </a>
</div>

<div style="margin-bottom:0.5rem;font-size:0.875rem;color:var(--text-secondary);">{{.User.Username}}</div>

<!-- Current Usage -->
<div class="v2-card" style="margin-bottom:1rem;">
    <div style="font-size:0.9375rem;font-weight:600;color:var(--text-primary);margin-bottom:1rem;">
        {{T .Lang "users.quota.usage"}}
    </div>

    <!-- Total -->
    <div style="margin-bottom:1rem;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.375rem;">
            <span style="font-size:0.8125rem;font-weight:500;color:var(--text-secondary);">Total</span>
            <span style="font-size:0.8125rem;color:var(--text-muted);">
                {{if eq .QuotaInfo.QuotaTotalGB 0}}
                {{.QuotaInfo.UsedTotalGB | printf "%.2f"}} GB / {{T .Lang "dashboard.user.quota.unlimited"}}
                {{else}}
                {{.QuotaInfo.UsedTotalGB | printf "%.2f"}} GB / {{.QuotaInfo.QuotaTotalGB}} GB ({{.QuotaInfo.PercentUsed | printf "%.1f"}}%)
                {{end}}
            </span>
        </div>
        <div style="width:100%;height:6px;background:var(--border);border-radius:3px;overflow:hidden;">
            <div style="height:100%;border-radius:3px;width:{{.QuotaInfo.PercentUsed}}%;background:{{if eq .QuotaInfo.AlertLevel "critical"}}var(--error){{else if eq .QuotaInfo.AlertLevel "danger"}}var(--warning){{else if eq .QuotaInfo.AlertLevel "warning"}}#eab308{{else}}var(--success){{end}};"></div>
        </div>
    </div>

    <!-- Backup -->
    <div style="margin-bottom:1rem;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.375rem;">
            <span style="font-size:0.8125rem;font-weight:500;color:var(--text-secondary);">Backup</span>
            <span style="font-size:0.8125rem;color:var(--text-muted);">
                {{if eq .QuotaInfo.QuotaBackupGB 0}}
                {{.QuotaInfo.UsedBackupGB | printf "%.2f"}} GB / {{T .Lang "dashboard.user.quota.unlimited"}}
                {{else}}
                {{.QuotaInfo.UsedBackupGB | printf "%.2f"}} GB / {{.QuotaInfo.QuotaBackupGB}} GB ({{.QuotaInfo.PercentBackup | printf "%.1f"}}%)
                {{end}}
            </span>
        </div>
        <div style="width:100%;height:6px;background:var(--border);border-radius:3px;overflow:hidden;">
            <div style="height:100%;border-radius:3px;width:{{.QuotaInfo.PercentBackup}}%;background:{{if eq .QuotaInfo.BackupAlertLevel "critical"}}var(--error){{else if eq .QuotaInfo.BackupAlertLevel "danger"}}var(--warning){{else if eq .QuotaInfo.BackupAlertLevel "warning"}}#eab308{{else}}var(--success){{end}};"></div>
        </div>
    </div>

    <!-- Data -->
    <div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.375rem;">
            <span style="font-size:0.8125rem;font-weight:500;color:var(--text-secondary);">Data</span>
            <span style="font-size:0.8125rem;color:var(--text-muted);">
                {{if eq .QuotaInfo.QuotaDataGB 0}}
                {{.QuotaInfo.UsedDataGB | printf "%.2f"}} GB / {{T .Lang "dashboard.user.quota.unlimited"}}
                {{else}}
                {{.QuotaInfo.UsedDataGB | printf "%.2f"}} GB / {{.QuotaInfo.QuotaDataGB}} GB ({{.QuotaInfo.PercentData | printf "%.1f"}}%)
                {{end}}
            </span>
        </div>
        <div style="width:100%;height:6px;background:var(--border);border-radius:3px;overflow:hidden;">
            <div style="height:100%;border-radius:3px;width:{{.QuotaInfo.PercentData}}%;background:{{if eq .QuotaInfo.DataAlertLevel "critical"}}var(--error){{else if eq .QuotaInfo.DataAlertLevel "danger"}}var(--warning){{else if eq .QuotaInfo.DataAlertLevel "warning"}}#eab308{{else}}var(--success){{end}};"></div>
        </div>
    </div>
</div>

<!-- Edit Form -->
<div class="v2-card">
    <div style="font-size:0.9375rem;font-weight:600;color:var(--text-primary);margin-bottom:1rem;">
        {{T .Lang "users.quota.edit"}}
    </div>

    <!-- Compression note -->
    <div class="v2-card" style="border-left:3px solid var(--info);margin-bottom:1rem;background:var(--bg-page);">
        <div style="font-size:0.8125rem;font-weight:600;color:var(--text-primary);margin-bottom:0.25rem;">
            {{T .Lang "users.quota.compression_note_title"}}
        </div>
        <div style="font-size:0.8125rem;color:var(--text-secondary);">
            {{T .Lang "users.quota.compression_note_text"}}
        </div>
    </div>

    <form method="POST" action="/admin/users/{{.User.ID}}/quota">
        <div style="margin-bottom:1rem;">
            <label style="display:block;font-size:0.8125rem;font-weight:500;color:var(--text-secondary);margin-bottom:0.375rem;">
                {{T .Lang "users.quota_backup"}}
            </label>
            <input type="number" name="quota_backup_gb" value="{{.User.QuotaBackupGB}}" min="0" required
                   style="width:100%;padding:0.5rem 0.75rem;border:1px solid var(--border);border-radius:0.5rem;background:var(--bg-page);color:var(--text-primary);font-size:0.875rem;">
            <div style="font-size:0.75rem;color:var(--text-muted);margin-top:0.25rem;">
                {{T .Lang "users.quota.backup_help"}} (0 = {{T .Lang "dashboard.user.quota.unlimited"}})
            </div>
        </div>

        <div style="margin-bottom:1rem;">
            <label style="display:block;font-size:0.8125rem;font-weight:500;color:var(--text-secondary);margin-bottom:0.375rem;">
                {{T .Lang "users.quota_data"}}
            </label>
            <input type="number" id="quota_data_gb" name="quota_data_gb" value="{{.QuotaInfo.QuotaDataGB}}" min="0" required
                   style="width:100%;padding:0.5rem 0.75rem;border:1px solid var(--border);border-radius:0.5rem;background:var(--bg-page);color:var(--text-primary);font-size:0.875rem;">
            <div style="font-size:0.75rem;color:var(--text-muted);margin-top:0.25rem;">
                {{T .Lang "users.quota.data_help"}} (0 = {{T .Lang "dashboard.user.quota.unlimited"}})
            </div>
        </div>

        <!-- Total (auto-calculated) -->
        <div style="background:var(--bg-page);padding:0.75rem 1rem;border-radius:0.5rem;border:1px solid var(--border);margin-bottom:1.5rem;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
                <span style="font-size:0.8125rem;font-weight:500;color:var(--text-secondary);">{{T .Lang "users.quota.total_label"}}</span>
                <span style="font-size:1rem;font-weight:600;color:var(--info);" id="quota_total_display">{{.User.QuotaTotalGB}} GB</span>
            </div>
        </div>


        <div style="display:flex;justify-content:flex-end;gap:0.5rem;">
            <a href="/admin/users" class="v2-btn" style="text-decoration:none;">{{T .Lang "common.cancel"}}</a>
            <button type="submit" class="v2-btn v2-btn-primary">{{T .Lang "users.quota.update"}}</button>
        </div>
    </form>
</div>
{{end}}
{{define "pageScripts"}}<script src="/static/js/quota.js"></script>{{end}}
