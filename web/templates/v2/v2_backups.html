{{/* Anemone v2 - Backups consolidated page with tabs */}}
{{define "content"}}
<!-- Tab navigation -->
<div class="v2-tabs" id="backupTabs">
    <button class="v2-tab active" data-tab="usb" onclick="switchTab('usb')">
        <svg style="display:inline;width:16px;height:16px;vertical-align:middle;margin-right:4px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="4" width="16" height="16" rx="2"/><path d="M9 1v3"/><path d="M15 1v3"/><path d="M9 20v3"/><path d="M15 20v3"/></svg>
        USB
    </button>
    <button class="v2-tab" data-tab="cloud" onclick="switchTab('cloud')">
        <svg style="display:inline;width:16px;height:16px;vertical-align:middle;margin-right:4px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>
        Cloud
    </button>
    <button class="v2-tab" data-tab="p2p" onclick="switchTab('p2p')">
        <svg style="display:inline;width:16px;height:16px;vertical-align:middle;margin-right:4px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/><polyline points="21 16 21 21 16 21"/><line x1="15" y1="15" x2="21" y2="21"/><line x1="4" y1="4" x2="9" y2="9"/></svg>
        P2P Sync
    </button>
    <button class="v2-tab" data-tab="incoming" onclick="switchTab('incoming')">
        <svg style="display:inline;width:16px;height:16px;vertical-align:middle;margin-right:4px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        Incoming
    </button>
    <button class="v2-tab" data-tab="server" onclick="switchTab('server')">
        <svg style="display:inline;width:16px;height:16px;vertical-align:middle;margin-right:4px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="8" rx="2"/><rect x="2" y="14" width="20" height="8" rx="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></svg>
        Server
    </button>
</div>

<!-- ===== USB Tab ===== -->
<div class="v2-tab-panel active" id="tab-usb">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
        <div style="font-size:0.9375rem;font-weight:700;color:var(--text-primary);">{{T .Lang "v2.backups.usb.title"}}</div>
        <a href="/admin/usb-backup/add" class="v2-btn v2-btn-primary v2-btn-sm">+ {{T .Lang "v2.backups.add"}}</a>
    </div>

    {{if .USBBackups}}
    <div class="v2-card" style="padding:0;overflow:hidden;">
        <table class="v2-table">
            <thead>
                <tr>
                    <th>{{T .Lang "v2.backups.usb.name"}}</th>
                    <th>{{T .Lang "v2.backups.usb.device"}}</th>
                    <th>{{T .Lang "v2.backups.usb.status"}}</th>
                    <th>{{T .Lang "v2.backups.usb.last_sync"}}</th>
                    <th>{{T .Lang "v2.backups.actions"}}</th>
                </tr>
            </thead>
            <tbody>
                {{range .USBBackups}}
                <tr>
                    <td style="font-weight:600;">{{.Name}}</td>
                    <td><code style="font-size:0.8125rem;color:var(--text-secondary);">{{.DevicePath}}</code></td>
                    <td>
                        {{if .IsMounted}}
                            <span class="v2-badge v2-badge-success">{{T $.Lang "v2.backups.usb.mounted"}}</span>
                        {{else}}
                            <span class="v2-badge v2-badge-warning">{{T $.Lang "v2.backups.usb.unmounted"}}</span>
                        {{end}}
                    </td>
                    <td style="font-size:0.8125rem;color:var(--text-secondary);">{{.LastSync}}</td>
                    <td>
                        <div style="display:flex;gap:0.5rem;">
                            {{if .IsMounted}}
                            <form method="POST" action="/admin/usb-backup/{{.ID}}/sync" style="display:inline;">
                                <button type="submit" class="v2-btn v2-btn-primary v2-btn-sm">Sync</button>
                            </form>
                            {{end}}
                            <a href="/admin/usb-backup/{{.ID}}/edit" class="v2-btn v2-btn-secondary v2-btn-sm">{{T $.Lang "v2.backups.edit"}}</a>
                        </div>
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
    {{else}}
    <div class="v2-card v2-empty">
        <svg class="v2-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="4" y="4" width="16" height="16" rx="2"/><path d="M9 1v3"/><path d="M15 1v3"/></svg>
        <div style="font-size:0.875rem;margin-bottom:0.5rem;">{{T .Lang "v2.backups.usb.empty"}}</div>
        <a href="/admin/usb-backup/add" class="v2-btn v2-btn-primary v2-btn-sm">+ {{T .Lang "v2.backups.add"}}</a>
    </div>
    {{end}}

    {{if .USBDrives}}
    <div style="margin-top:1rem;">
        <div style="font-size:0.8125rem;font-weight:600;color:var(--text-secondary);margin-bottom:0.5rem;">{{T .Lang "v2.backups.usb.available_drives"}}</div>
        <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
            {{range .USBDrives}}
            <div class="v2-card" style="padding:0.75rem;display:flex;align-items:center;gap:0.5rem;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>
                <span style="font-size:0.8125rem;">{{.Name}}</span>
                <span style="font-size:0.75rem;color:var(--text-muted);">{{.Size}}</span>
            </div>
            {{end}}
        </div>
    </div>
    {{end}}
</div>

<!-- ===== Cloud Tab ===== -->
<div class="v2-tab-panel" id="tab-cloud">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
        <div style="font-size:0.9375rem;font-weight:700;color:var(--text-primary);">{{T .Lang "v2.backups.cloud.title"}}</div>
        <a href="/admin/rclone/add" class="v2-btn v2-btn-primary v2-btn-sm">+ {{T .Lang "v2.backups.add"}}</a>
    </div>

    {{if .RcloneConfigs}}
    <div class="v2-card" style="padding:0;overflow:hidden;">
        <table class="v2-table">
            <thead>
                <tr>
                    <th>{{T .Lang "v2.backups.cloud.name"}}</th>
                    <th>{{T .Lang "v2.backups.cloud.host"}}</th>
                    <th>{{T .Lang "v2.backups.cloud.status"}}</th>
                    <th>{{T .Lang "v2.backups.cloud.last_sync"}}</th>
                    <th>{{T .Lang "v2.backups.actions"}}</th>
                </tr>
            </thead>
            <tbody>
                {{range .RcloneConfigs}}
                <tr>
                    <td style="font-weight:600;">{{.Name}}</td>
                    <td style="font-size:0.8125rem;color:var(--text-secondary);">{{.Host}}:{{.RemotePath}}</td>
                    <td>
                        {{if .Enabled}}
                            <span class="v2-badge v2-badge-success">{{T $.Lang "v2.backups.cloud.enabled"}}</span>
                        {{else}}
                            <span class="v2-badge v2-badge-warning">{{T $.Lang "v2.backups.cloud.disabled"}}</span>
                        {{end}}
                    </td>
                    <td style="font-size:0.8125rem;color:var(--text-secondary);">{{.LastSync}}</td>
                    <td>
                        <div style="display:flex;gap:0.5rem;">
                            <form method="POST" action="/admin/rclone/{{.ID}}/sync" style="display:inline;">
                                <button type="submit" class="v2-btn v2-btn-primary v2-btn-sm">Sync</button>
                            </form>
                            <a href="/admin/rclone/{{.ID}}/edit" class="v2-btn v2-btn-secondary v2-btn-sm">{{T $.Lang "v2.backups.edit"}}</a>
                        </div>
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
    {{else}}
    <div class="v2-card v2-empty">
        <svg class="v2-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>
        <div style="font-size:0.875rem;margin-bottom:0.5rem;">{{T .Lang "v2.backups.cloud.empty"}}</div>
        <a href="/admin/rclone/add" class="v2-btn v2-btn-primary v2-btn-sm">+ {{T .Lang "v2.backups.add"}}</a>
    </div>
    {{end}}

    <!-- SSH Key section -->
    {{if .SSHKeyExists}}
    <div class="v2-card" style="margin-top:1rem;">
        <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.75rem;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
            <span style="font-size:0.875rem;font-weight:600;color:var(--text-primary);">{{T .Lang "v2.backups.cloud.ssh_key"}}</span>
            <span class="v2-badge v2-badge-success">{{T .Lang "v2.backups.cloud.configured"}}</span>
        </div>
        <div style="font-size:0.75rem;color:var(--text-muted);">{{T .Lang "v2.backups.cloud.ssh_hint"}}</div>
    </div>
    {{end}}
</div>

<!-- ===== P2P Sync Tab ===== -->
<div class="v2-tab-panel" id="tab-p2p">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
        <div style="font-size:0.9375rem;font-weight:700;color:var(--text-primary);">{{T .Lang "v2.backups.p2p.title"}}</div>
        <div style="display:flex;gap:0.5rem;">
            <a href="/admin/sync/config" class="v2-btn v2-btn-secondary v2-btn-sm">{{T .Lang "v2.backups.p2p.configure"}}</a>
            <form method="POST" action="/admin/sync/force" style="display:inline;">
                <button type="submit" class="v2-btn v2-btn-primary v2-btn-sm">{{T .Lang "v2.backups.p2p.force_sync"}}</button>
            </form>
        </div>
    </div>

    <!-- Sync config status -->
    <div class="v2-card" style="margin-bottom:1rem;">
        <div style="display:flex;align-items:center;gap:1.5rem;flex-wrap:wrap;">
            <div>
                <div style="font-size:0.75rem;color:var(--text-muted);">{{T .Lang "v2.backups.p2p.status_label"}}</div>
                <div style="font-size:0.875rem;font-weight:600;">
                    {{if .SyncEnabled}}
                        <span style="color:var(--success);">{{T .Lang "v2.backups.p2p.enabled"}}</span>
                    {{else}}
                        <span style="color:var(--text-muted);">{{T .Lang "v2.backups.p2p.disabled"}}</span>
                    {{end}}
                </div>
            </div>
            {{if .SyncInterval}}
            <div>
                <div style="font-size:0.75rem;color:var(--text-muted);">{{T .Lang "v2.backups.p2p.interval"}}</div>
                <div style="font-size:0.875rem;font-weight:600;color:var(--text-primary);">{{.SyncInterval}}</div>
            </div>
            {{end}}
        </div>
    </div>

    <!-- Recent syncs -->
    {{if .RecentSyncs}}
    <div class="v2-card" style="padding:0;overflow:hidden;">
        <table class="v2-table">
            <thead>
                <tr>
                    <th>{{T .Lang "v2.backups.p2p.peer"}}</th>
                    <th>{{T .Lang "v2.backups.p2p.user"}}</th>
                    <th>{{T .Lang "v2.backups.usb.status"}}</th>
                    <th>{{T .Lang "v2.backups.p2p.files"}}</th>
                    <th>{{T .Lang "v2.backups.p2p.size"}}</th>
                    <th>{{T .Lang "v2.backups.p2p.date"}}</th>
                </tr>
            </thead>
            <tbody>
                {{range .RecentSyncs}}
                <tr>
                    <td style="font-weight:600;">{{.PeerName}}</td>
                    <td>{{.Username}}</td>
                    <td>
                        {{if eq .Status "success"}}
                            <span class="v2-badge v2-badge-success">{{T $.Lang "v2.backups.status.success"}}</span>
                        {{else if eq .Status "error"}}
                            <span class="v2-badge v2-badge-error">{{T $.Lang "v2.backups.status.error"}}</span>
                        {{else}}
                            <span class="v2-badge v2-badge-warning">{{.Status}}</span>
                        {{end}}
                    </td>
                    <td>{{.FilesSynced}}</td>
                    <td>{{.BytesSynced}}</td>
                    <td style="font-size:0.8125rem;color:var(--text-secondary);">{{.CompletedAt}}</td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
    {{else}}
    <div class="v2-card v2-empty">
        <div style="font-size:0.875rem;">{{T .Lang "v2.backups.p2p.empty"}}</div>
    </div>
    {{end}}
</div>

<!-- ===== Incoming Tab ===== -->
<div class="v2-tab-panel" id="tab-incoming">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
        <div style="font-size:0.9375rem;font-weight:700;color:var(--text-primary);">{{T .Lang "v2.backups.incoming.title"}}</div>
    </div>

    {{if .IncomingBackups}}
    <div class="v2-stats-grid" style="margin-bottom:1rem;">
        <div class="v2-card">
            <div class="v2-card-title">{{T .Lang "v2.backups.incoming.total_backups"}}</div>
            <div class="v2-card-value">{{.IncomingCount}}</div>
        </div>
        <div class="v2-card">
            <div class="v2-card-title">{{T .Lang "v2.backups.incoming.total_size"}}</div>
            <div class="v2-card-value">{{.IncomingSize}}</div>
        </div>
    </div>

    <div class="v2-card" style="padding:0;overflow:hidden;">
        <table class="v2-table">
            <thead>
                <tr>
                    <th>{{T .Lang "v2.backups.incoming.source"}}</th>
                    <th>{{T .Lang "v2.backups.incoming.user"}}</th>
                    <th>{{T .Lang "v2.backups.incoming.share"}}</th>
                    <th>{{T .Lang "v2.backups.incoming.files"}}</th>
                    <th>{{T .Lang "v2.backups.p2p.size"}}</th>
                    <th>{{T .Lang "v2.backups.actions"}}</th>
                </tr>
            </thead>
            <tbody>
                {{range .IncomingBackups}}
                <tr>
                    <td style="font-weight:600;">{{.SourceServer}}</td>
                    <td>{{.UserID}}</td>
                    <td>{{.ShareName}}</td>
                    <td>{{.FileCount}}</td>
                    <td>{{.TotalSizeFormatted}}</td>
                    <td>
                        <form method="POST" action="/admin/incoming/delete" onsubmit="return confirm('{{T $.Lang "v2.backups.confirm_delete"}}');">
                            <input type="hidden" name="path" value="{{.Path}}">
                            <button type="submit" class="v2-btn v2-btn-danger v2-btn-sm">{{T $.Lang "v2.backups.delete"}}</button>
                        </form>
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
    {{else}}
    <div class="v2-card v2-empty">
        <svg class="v2-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        <div style="font-size:0.875rem;">{{T .Lang "v2.backups.incoming.empty"}}</div>
    </div>
    {{end}}
</div>

<!-- ===== Server Backup Tab ===== -->
<div class="v2-tab-panel" id="tab-server">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
        <div style="font-size:0.9375rem;font-weight:700;color:var(--text-primary);">{{T .Lang "v2.backups.server.title"}}</div>
        <form method="POST" action="/admin/backup/create" style="display:inline;">
            <button type="submit" class="v2-btn v2-btn-primary v2-btn-sm">+ {{T .Lang "v2.backups.server.create"}}</button>
        </form>
    </div>

    {{if .ServerBackups}}
    <div class="v2-card" style="padding:0;overflow:hidden;">
        <table class="v2-table">
            <thead>
                <tr>
                    <th>{{T .Lang "v2.backups.server.filename"}}</th>
                    <th>{{T .Lang "v2.backups.p2p.size"}}</th>
                    <th>{{T .Lang "v2.backups.p2p.date"}}</th>
                    <th>{{T .Lang "v2.backups.actions"}}</th>
                </tr>
            </thead>
            <tbody>
                {{range .ServerBackups}}
                <tr>
                    <td style="font-weight:600;">{{.Name}}</td>
                    <td>{{.SizeFormatted}}</td>
                    <td style="font-size:0.8125rem;color:var(--text-secondary);">{{.Date}}</td>
                    <td>
                        <div style="display:flex;gap:0.5rem;">
                            <a href="/admin/backup/download?file={{.Name}}" class="v2-btn v2-btn-secondary v2-btn-sm">{{T $.Lang "v2.backups.server.download"}}</a>
                            <form method="POST" action="/admin/backup/delete" onsubmit="return confirm('{{T $.Lang "v2.backups.confirm_delete"}}');">
                                <input type="hidden" name="file" value="{{.Name}}">
                                <button type="submit" class="v2-btn v2-btn-danger v2-btn-sm">{{T $.Lang "v2.backups.delete"}}</button>
                            </form>
                        </div>
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
    {{else}}
    <div class="v2-card v2-empty">
        <svg class="v2-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="2" width="20" height="8" rx="2"/><rect x="2" y="14" width="20" height="8" rx="2"/></svg>
        <div style="font-size:0.875rem;margin-bottom:0.5rem;">{{T .Lang "v2.backups.server.empty"}}</div>
        <form method="POST" action="/admin/backup/create" style="display:inline;">
            <button type="submit" class="v2-btn v2-btn-primary v2-btn-sm">+ {{T .Lang "v2.backups.server.create"}}</button>
        </form>
    </div>
    {{end}}
</div>

<!-- Tab switching script -->
<script>
function switchTab(tab) {
    // Update URL
    var url = new URL(window.location);
    url.searchParams.set('tab', tab);
    window.history.replaceState({}, '', url);

    // Update tab buttons
    document.querySelectorAll('.v2-tab').forEach(function(t) {
        t.classList.toggle('active', t.getAttribute('data-tab') === tab);
    });

    // Update panels
    document.querySelectorAll('.v2-tab-panel').forEach(function(p) {
        p.classList.toggle('active', p.id === 'tab-' + tab);
    });
}

// Restore tab from URL on load
(function() {
    var params = new URLSearchParams(window.location.search);
    var tab = params.get('tab');
    if (tab && document.getElementById('tab-' + tab)) {
        switchTab(tab);
    }
})();
</script>
{{end}}
