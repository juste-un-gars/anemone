{{define "headerActions"}}
{{if .CurrentShare}}
<button data-action="openModal" data-target="uploadModal" class="v2-btn v2-btn-primary" style="font-size:0.8125rem;padding:0.375rem 0.75rem;">
    <svg style="width:16px;height:16px;margin-right:0.25rem;vertical-align:middle;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
    </svg>
    {{T .Lang "files.upload"}}
</button>
<button data-action="openModal" data-target="mkdirModal" class="v2-btn" style="font-size:0.8125rem;padding:0.375rem 0.75rem;">
    <svg style="width:16px;height:16px;margin-right:0.25rem;vertical-align:middle;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
    </svg>
    {{T .Lang "files.new_folder"}}
</button>
{{end}}
{{end}}

{{define "content"}}
<!-- Share selector (if multiple shares) -->
{{if and (not .CurrentShare) (gt (len .Shares) 1)}}
<div class="v2-card" style="padding:2rem;text-align:center;">
    <svg style="margin:0 auto 1rem;width:48px;height:48px;color:var(--text-muted);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
    </svg>
    <h3 style="font-size:0.9375rem;font-weight:600;color:var(--text-primary);margin-bottom:0.75rem;">{{T .Lang "files.select_share"}}</h3>
    <div style="display:flex;flex-wrap:wrap;gap:0.75rem;justify-content:center;">
        {{range .Shares}}
        <a href="/files?share={{.Name}}" class="v2-btn v2-btn-primary" style="font-size:0.875rem;padding:0.5rem 1.25rem;">
            <svg style="width:18px;height:18px;margin-right:0.375rem;vertical-align:middle;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
            </svg>
            {{.Name}}
        </a>
        {{end}}
    </div>
</div>
{{else if .CurrentShare}}

<!-- Share switcher + Breadcrumb -->
<div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:1rem;flex-wrap:wrap;">
    {{if gt (len .Shares) 1}}
    <select id="shareSelector" style="padding:0.375rem 0.5rem;border-radius:6px;border:1px solid var(--border);background:var(--bg-card);color:var(--text-primary);font-size:0.8125rem;">
        {{range $.Shares}}
        <option value="{{.Name}}" {{if eq .Name $.CurrentShare}}selected{{end}}>{{.Name}}</option>
        {{end}}
    </select>
    {{end}}

    <nav style="display:flex;align-items:center;gap:0.25rem;font-size:0.8125rem;">
        <a href="/files?share={{.CurrentShare}}" style="color:var(--info);text-decoration:none;">
            <svg style="width:16px;height:16px;vertical-align:middle;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-4 0h4"/>
            </svg>
        </a>
        {{range .Breadcrumb}}
        <span style="color:var(--text-muted);">/</span>
        <a href="/files?share={{$.CurrentShare}}&path={{.Path}}" style="color:var(--info);text-decoration:none;">{{.Name}}</a>
        {{end}}
    </nav>
</div>

<!-- File table -->
{{if .Files}}
<div class="v2-card" style="padding:0;overflow:hidden;">
    <table class="v2-table">
        <thead>
            <tr>
                <th>{{T .Lang "files.column.name"}}</th>
                <th>{{T .Lang "files.column.size"}}</th>
                <th>{{T .Lang "files.column.modified"}}</th>
                <th style="text-align:right;">{{T .Lang "files.column.actions"}}</th>
            </tr>
        </thead>
        <tbody>
            {{range .Files}}
            <tr>
                <td>
                    <div style="display:flex;align-items:center;gap:0.5rem;">
                        {{if .IsDir}}
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--warning)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                        </svg>
                        <a href="/files?share={{$.CurrentShare}}&path={{.Path}}" style="font-weight:500;color:var(--info);text-decoration:none;">{{.Name}}</a>
                        {{else}}
                        {{if eq .MimeType "image"}}
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/>
                        </svg>
                        {{else if eq .MimeType "video"}}
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--error)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                        </svg>
                        {{else if eq .MimeType "audio"}}
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--info)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/>
                        </svg>
                        {{else if eq .MimeType "document"}}
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--info)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        {{else if eq .MimeType "archive"}}
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--warning)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 8v13H3V8"/><path d="M1 3h22v5H1z"/><path d="M10 12h4"/>
                        </svg>
                        {{else}}
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/>
                        </svg>
                        {{end}}
                        <span style="font-weight:500;color:var(--text-primary);">{{.Name}}</span>
                        {{end}}
                    </div>
                </td>
                <td style="color:var(--text-secondary);white-space:nowrap;">
                    {{if .IsDir}}
                        &mdash;
                    {{else}}
                        {{FormatBytes .Size}}
                    {{end}}
                </td>
                <td style="color:var(--text-muted);white-space:nowrap;">
                    {{FormatTime .ModTime $.Lang}}
                </td>
                <td style="text-align:right;">
                    <div style="display:flex;align-items:center;justify-content:flex-end;gap:0.375rem;">
                        {{if not .IsDir}}
                        {{if and $.OOEnabled (IsOOEditable .Name)}}
                        <a href="/files/edit?share={{$.CurrentShare}}&path={{.Path}}" class="v2-btn" style="font-size:0.75rem;padding:0.25rem 0.5rem;background:rgba(16,185,129,0.12);color:var(--success);border:1px solid rgba(16,185,129,0.2);text-decoration:none;">
                            {{T $.Lang "files.action.edit"}}
                        </a>
                        {{end}}
                        {{if IsViewable .Name}}
                        <a href="/api/files/download?share={{$.CurrentShare}}&path={{.Path}}&inline=1" target="_blank" class="v2-btn" style="font-size:0.75rem;padding:0.25rem 0.5rem;background:rgba(139,92,246,0.12);color:#a78bfa;border:1px solid rgba(139,92,246,0.2);text-decoration:none;">
                            {{T $.Lang "files.action.view"}}
                        </a>
                        {{end}}
                        <a href="/api/files/download?share={{$.CurrentShare}}&path={{.Path}}" class="v2-btn" style="font-size:0.75rem;padding:0.25rem 0.5rem;background:rgba(99,102,241,0.12);color:var(--info);border:1px solid rgba(99,102,241,0.2);text-decoration:none;">
                            {{T $.Lang "files.action.download"}}
                        </a>
                        {{end}}
                        <button data-action="renameItem" data-share="{{$.CurrentShare}}" data-path="{{.Path}}" data-name="{{.Name}}" class="v2-btn" style="font-size:0.75rem;padding:0.25rem 0.5rem;background:rgba(245,158,11,0.12);color:var(--warning);border:1px solid rgba(245,158,11,0.2);">
                            {{T $.Lang "files.action.rename"}}
                        </button>
                        <button data-action="deleteItem" data-share="{{$.CurrentShare}}" data-path="{{.Path}}" data-name="{{.Name}}" class="v2-btn" style="font-size:0.75rem;padding:0.25rem 0.5rem;background:rgba(239,68,68,0.12);color:var(--error);border:1px solid rgba(239,68,68,0.2);">
                            {{T $.Lang "files.action.delete"}}
                        </button>
                    </div>
                </td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>
{{else}}
<!-- Empty folder -->
<div class="v2-card" style="padding:3rem;text-align:center;">
    <svg style="margin:0 auto 1rem;width:48px;height:48px;color:var(--text-muted);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
    </svg>
    <h3 style="font-size:0.9375rem;font-weight:600;color:var(--text-primary);margin-bottom:0.25rem;">{{T .Lang "files.empty"}}</h3>
    <p style="font-size:0.8125rem;color:var(--text-muted);">{{T .Lang "files.empty_hint"}}</p>
</div>
{{end}}
{{end}}

<!-- Upload modal -->
<div id="uploadModal" class="hidden" style="position:fixed;inset:0;z-index:1000;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);">
    <div class="v2-card" style="width:90%;max-width:480px;padding:1.5rem;">
        <h3 style="font-size:1rem;font-weight:600;color:var(--text-primary);margin-bottom:1rem;">{{T .Lang "files.upload_title"}}</h3>
        <form id="uploadForm" enctype="multipart/form-data">
            <input type="file" id="uploadFiles" name="files" multiple style="width:100%;margin-bottom:1rem;padding:0.5rem;border:1px dashed var(--border);border-radius:6px;background:var(--bg-page);color:var(--text-primary);">
            <div id="uploadProgress" class="hidden" style="margin-bottom:1rem;">
                <div style="height:6px;border-radius:3px;background:var(--border);overflow:hidden;">
                    <div id="uploadBar" style="height:100%;width:0%;background:var(--info);transition:width 0.3s;"></div>
                </div>
                <span id="uploadPercent" style="font-size:0.75rem;color:var(--text-muted);">0%</span>
            </div>
            <div style="display:flex;gap:0.5rem;justify-content:flex-end;">
                <button type="button" data-action="closeModal" data-target="uploadModal" class="v2-btn" style="font-size:0.8125rem;padding:0.375rem 0.75rem;">{{T .Lang "files.cancel"}}</button>
                <button type="submit" class="v2-btn v2-btn-primary" style="font-size:0.8125rem;padding:0.375rem 0.75rem;">{{T .Lang "files.upload"}}</button>
            </div>
        </form>
    </div>
</div>

<!-- Mkdir modal -->
<div id="mkdirModal" class="hidden" style="position:fixed;inset:0;z-index:1000;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);">
    <div class="v2-card" style="width:90%;max-width:400px;padding:1.5rem;">
        <h3 style="font-size:1rem;font-weight:600;color:var(--text-primary);margin-bottom:1rem;">{{T .Lang "files.new_folder_title"}}</h3>
        <form id="mkdirForm">
            <input type="text" id="mkdirName" placeholder="{{T .Lang "files.folder_name_placeholder"}}" style="width:100%;margin-bottom:1rem;padding:0.5rem;border:1px solid var(--border);border-radius:6px;background:var(--bg-page);color:var(--text-primary);box-sizing:border-box;">
            <div style="display:flex;gap:0.5rem;justify-content:flex-end;">
                <button type="button" data-action="closeModal" data-target="mkdirModal" class="v2-btn" style="font-size:0.8125rem;padding:0.375rem 0.75rem;">{{T .Lang "files.cancel"}}</button>
                <button type="submit" class="v2-btn v2-btn-primary" style="font-size:0.8125rem;padding:0.375rem 0.75rem;">{{T .Lang "files.create"}}</button>
            </div>
        </form>
    </div>
</div>

<!-- Rename modal -->
<div id="renameModal" class="hidden" style="position:fixed;inset:0;z-index:1000;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);">
    <div class="v2-card" style="width:90%;max-width:400px;padding:1.5rem;">
        <h3 style="font-size:1rem;font-weight:600;color:var(--text-primary);margin-bottom:1rem;">{{T .Lang "files.rename_title"}}</h3>
        <form id="renameForm">
            <input type="hidden" id="renameOldPath" value="">
            <input type="hidden" id="renameShare" value="">
            <input type="text" id="renameNewName" style="width:100%;margin-bottom:1rem;padding:0.5rem;border:1px solid var(--border);border-radius:6px;background:var(--bg-page);color:var(--text-primary);box-sizing:border-box;">
            <div style="display:flex;gap:0.5rem;justify-content:flex-end;">
                <button type="button" data-action="closeModal" data-target="renameModal" class="v2-btn" style="font-size:0.8125rem;padding:0.375rem 0.75rem;">{{T .Lang "files.cancel"}}</button>
                <button type="submit" class="v2-btn v2-btn-primary" style="font-size:0.8125rem;padding:0.375rem 0.75rem;">{{T .Lang "files.rename_confirm"}}</button>
            </div>
        </form>
    </div>
</div>

{{end}}

{{define "pageScripts"}}
<script type="application/json" id="page-data">
{"currentShare": "{{.CurrentShare}}", "currentPath": "{{.CurrentPath}}", "translations": {"confirmDelete": "{{T .Lang "files.confirm_delete"}}", "deleteSuccess": "{{T .Lang "files.delete_success"}}", "mkdirSuccess": "{{T .Lang "files.mkdir_success"}}", "renameSuccess": "{{T .Lang "files.rename_success"}}", "uploadSuccess": "{{T .Lang "files.upload_success"}}", "error": "{{T .Lang "files.error_generic"}}"}}
</script>
<script src="/static/js/files.js"></script>
{{end}}
